<!DOCTYPE html>
<html>
<head>

    <link type="text/css" rel="stylesheet" href="./css/3rdParty/jquery-ui.min.css" />
    <link type="text/css" rel="stylesheet" href="./css/3rdParty/jquery.datatables.min.css" />
    <link type="text/css" rel="stylesheet" href="./css/3rdParty/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="./css/3rdParty/prettify.min.css" />

    <script type="text/javascript" src="./scripts/3rdParty/jquery-2.2.2.min.js"></script>
    <script type="text/javascript" src="./scripts/3rdParty/jquery-ui-1.11.4.min.js"></script>
    <script type="text/javascript" src="./scripts/3rdParty/jsgrid.min.js"></script>
    <script type="text/javascript" src="./scripts/3rdParty/jquery.dataTables.min.js"></script>

    <title>OCR WEB</title>
	<meta charset="utf-8" />
</head>
<body>

    <div class="container" style="margin-top:50px">

        <div class="ui-widget">
            <label for="healthCareId">ID seguridad social: </label>
            <input id="healthCareId">
            <button id="searchForIdButton" class="ui-button-icon-only">Search</button>
        </div>

        <div class="row form-inline the-box" style="width:80%; padding-top:15px; margin-left: 8px; margin-right: 8px;">
            <div id="divGrid" class="col-sm-12" style="padding:30px,0,0,0">
                <table id="jsGrid" class="dataTable table table-hover table-bordered table-responsive display pretty" cellspacing="0" style="text-align:center">
                    <thead>
                        <tr>
                            <th>Period Start</th>
                            <th>Period End</th>
                            <th>Money Contributor</th>
                            <th>High Res File Id</th>
                        </tr>
                    </thead>

                </table>
            </div>
        </div>

    </div>

    <script>
        var apiUrl = '@System.Configuration.ConfigurationManager.AppSettings["APIBaseUrl"]';
        var table;
        $(document).ready(function () {

            var url = apiUrl + "/ContributionPeriods/1";
            table = $('#jsGrid').DataTable({
                "dom": '<"top"if>rt<"bottom"lp><"clear">',
                "retrieve": true,
                "paging": false,
                "ajax": {
                    "url": url,
                    "dataSrc": ""
                },
                "columns": [
                    { "data": "PeriodStart" },
                    { "data": "PeriodEnd" },
                    { "data": "MoneyContribution" },
                    { "data": "HighResFileId" },
                    //{ "data": "Active", "class": "text-center" }
                ],
                "columnDefs": [
                    { "targets": 0, "title": "Period Start", "render": function (data) { return (!data) ? "" : data.split('T')[0]; } },
                    { "targets": 1, "title": "Period End", "render": function (data) { return (!data) ? "" : data.split('T')[0]; } },
                    { "targets": 2, "title": "Money Contribution", "render": function (data) { return (!data) ? "" : data; } },
                    { "targets": 3, "title": "HighRes FileId", "render": function (data) {
                        return (!data) ? "" : '<img src="' + 'file://C:\\Program Files (x86)\\IIS Express\\STORAGE\\' + data + '"/>';
                        }
                    }
                ]
            });
        });
        $("#searchForIdButton").button().click(function (event) {

            table.destroy();

            event.preventDefault();
            var healthCareId = $("#healthCareId").val().replace(/\s/g, "%20");
            if (healthCareId === '')
                healthCareId = '1';

            var queryUrl = apiUrl + "/ContributionPeriods/" + healthCareId;
            table = $('#jsGrid').DataTable({
                "dom": '<"top"if>rt<"bottom"lp><"clear">',
                "retrieve": true,
                "paging": false,
                "ajax": {
                    "url": queryUrl,
                    "dataSrc": ""
                },
                "columns": [
                    { "data": "PeriodStart", "class": "text-center" },
                    { "data": "PeriodEnd", "class": "text-center" },
                    { "data": "MoneyContribution", "class": "text-center" },
                    { "data": "HighResFileId", "class": "text-center" },
                    //{ "data": "Active", "class": "text-center" }
                ],
                "columnDefs": [
                    {
                        "targets": 0, "title": "Period Start", "render": function (data) { return (!data) ? "" : data.split('T')[0]; } },
                    { "targets": 1, "title": "Period End", "render": function (data) { return (!data) ? "" : data.split('T')[0]; } },
                    { "targets": 2, "title": "Money Contribution", "render": function (data) { return (!data) ? "" : data; } },
                    {
                        "targets": 3, "title": "HighRes FileId", "render": function (data) {
                            return (!data) ? "" : '<img src="' + 'file://C:\\Program Files (x86)\\IIS Express\\STORAGE\\' + data + '"/>';
                        }
                    }
                ]
            });
            
            $('#jsGrid tbody').on('click', 'td', function () {
                debugger;
                var colIdx = table
                        .cell(this)
                        .index().column;

                if (colIdx == 3) {
                    alert('grrr me tocaste!!');
                }
            });

            // Hola Dani. Estaba mirando por aquí --> http://jsfiddle.net/M3kj6/1/
            //function createObjectURL(object) {
            //    return (window.URL) ? window.URL.createObjectURL(object) : window.webkitURL.createObjectURL(object);
            //}

            //function revokeObjectURL(url) {
            //    return (window.URL) ? window.URL.revokeObjectURL(url) : window.webkitURL.revokeObjectURL(url);
            //}

        });
    </script>

</body>

</html>
